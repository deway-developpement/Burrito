<app-background-div>
  <div class="nav-bar">
    <app-go-back></app-go-back>
  </div>

  <div class="page-container">
    <app-admin-page-header
      i18n-title="@@adminForms.title"
      title="Evaluation Forms"
      i18n-subtitle="@@adminForms.subtitle"
      subtitle="Browse, update, and publish the evaluation forms used across the platform."
      i18n-buttonLabel="@@adminForms.createButton"
      buttonLabel="Create new form"
      (action)="createForm()"
    ></app-admin-page-header>

  <section class="forms-section">
    <div class="forms-toolbar">
      <div class="forms-filter">
        <span class="forms-filter__label" i18n="@@adminForms.statusLabel">Status</span>
        <app-select
        variant="outline"
        [options]="statusOptions"
        [value]="statusFilter"
        (valueChange)="onStatusFilterChange($event)"
        ></app-select>
      </div>
      <app-button variant="primary" type="button" (click)="createForm()">
        <span i18n="@@adminForms.createButtonInline">Create new form</span>
      </app-button>
    </div>
    @if (error()) {
      <div class="error-banner">{{ error() }}</div>
    }

    <div class="forms-grid" *ngIf="!loading()">
      <article class="form-card" *ngFor="let form of forms()">
        <header class="card-header">
          <span class="status-badge" [ngClass]="getStatusClass(form.status)">
            {{ getStatusLabel(form.status) }}
          </span>
          <span class="date-pill" i18n="@@adminForms.endsLabel">
            Ends {{ formatDate(form.endDate) }}
          </span>
        </header>

        <div class="card-body">
          <h3 class="form-title">{{ form.title }}</h3>
          <p class="form-description" *ngIf="form.description">
            {{ form.description }}
          </p>

          <div class="form-meta">
            <div class="meta-row">
              <span class="meta-label" i18n="@@adminForms.teacherLabel">Teacher</span>
              <span class="meta-value">
                {{ getTeacherLabel(form) }}
              </span>
            </div>
            <div class="meta-row">
              <span class="meta-label" i18n="@@adminForms.startsLabel">Starts</span>
              <span class="meta-value">{{ formatDate(form.startDate) }}</span>
            </div>
            <div class="meta-row">
              <span class="meta-label" i18n="@@adminForms.endsMetaLabel">Ends</span>
              <span class="meta-value">{{ formatDate(form.endDate) }}</span>
            </div>
          </div>
          <div class="form-groups">
            <span class="form-groups__label" i18n="@@adminForms.groupsLabel">Groups</span>
            <div class="meta-groups">
              @if (form.groups?.length) {
                @for (group of form.groups; track group.id) {
                  <span class="meta-group-pill">{{ group.name }}</span>
                }
              } @else {
                <span class="meta-group-empty" i18n="@@adminForms.noGroups">No groups</span>
              }
            </div>
          </div>
        </div>

        <footer class="card-footer">
          <div class="card-actions">
            <div class="card-actions__left">
              <app-button
                *ngIf="form.status === 'DRAFT'"
                variant="primary"
                type="button"
                (click)="publishForm(form.id)"
                (keydown.enter)="publishForm(form.id)"
              >
                <span i18n="@@adminForms.publish">Post</span>
              </app-button>
              <app-button
                *ngIf="form.status === 'PUBLISHED'"
                variant="primary"
                type="button"
                (click)="closeForm(form.id)"
                (keydown.enter)="closeForm(form.id)"
              >
                <span i18n="@@adminForms.close">Close</span>
              </app-button>
            </div>
            <div class="card-actions__middle">
              <app-button
                *ngIf="form.status === 'DRAFT'"
                variant="outline"
                type="button"
                (click)="editForm(form.id)"
                (keydown.enter)="editForm(form.id)"
              >
                <span i18n="@@adminForms.edit">Edit</span>
              </app-button>
            </div>
            <div class="card-actions__right">
              <app-button variant="outline" type="button" (click)="deleteForm(form.id)">
                <span i18n="@@adminForms.delete">Delete</span>
              </app-button>
            </div>
          </div>
        </footer>
      </article>
    </div>

    <div class="loading-container" *ngIf="loading() && forms().length === 0">
      <p i18n="@@adminForms.loading">Loading forms...</p>
    </div>

    <div class="empty-state" *ngIf="!loading() && forms().length === 0">
      <p i18n="@@adminForms.empty">No forms available yet.</p>
    </div>

    <div class="load-more-container" *ngIf="hasMore() && forms().length > 0">
      <app-button
        variant="primary"
        type="button"
        [disabled]="loadMoreDisabled()"
        (click)="loadMoreForms()"
        (keydown.enter)="loadMoreForms()"
      >
        @if (loadMoreDisabled()) {
          <span i18n="@@adminForms.loadingMore">Loading...</span>
        } @else {
          <span i18n="@@adminForms.loadMore">Load more forms</span>
        }
      </app-button>
    </div>
    <div #loadMoreTrigger class="load-more-trigger" aria-hidden="true"></div>
  </section>

  </div>

  <app-alert-dialog
    [open]="alertDialogOpen"
    [title]="alertDialogTitle"
    [message]="alertDialogMessage"
    [confirmLabel]="alertDialogConfirmLabel"
    [cancelLabel]="alertDialogCancelLabel"
    [showCancel]="alertDialogShowCancel"
    [intent]="alertDialogIntent"
    (confirm)="confirmAlertDialog()"
    (cancelClick)="closeAlertDialog()"
  ></app-alert-dialog>
</app-background-div>
