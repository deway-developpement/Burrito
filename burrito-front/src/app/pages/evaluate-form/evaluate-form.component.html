<app-background-div>
  <div class="nav-bar">
    <app-go-back></app-go-back>
  </div>
  
  <div class="evaluate-container">
    <div class="evaluate-card" *ngIf="!loading && !error && formData">
      <div class="form-header">
        <h1>{{ formData.title }}</h1>
        <p class="form-description" *ngIf="formData.description">{{ formData.description }}</p>
        <div class="form-meta">
          <span *ngIf="formData.teacher" i18n="@@evaluateForm.teacherLabel">
            Teacher: {{ formData.teacher.fullName }}
          </span>
          <span *ngIf="formData.endDate" class="deadline" i18n="@@evaluateForm.deadlineLabel">
            Deadline: {{ formData.endDate | date: 'medium' }}
          </span>
        </div>
      </div>

      <form [formGroup]="evaluationForm" (ngSubmit)="onSubmit()" class="evaluation-form">
        <div class="question-block" *ngFor="let question of formData.questions; let i = index">
          <!-- Rating Question -->
          <div *ngIf="question.type === 'RATING'">
            <fieldset class="rating-container">
              <legend class="question-label">
                {{ i + 1 }}. {{ question.label }}
                <span class="required" *ngIf="question.required">*</span>
              </legend>
              <div class="rating-options">
                <label *ngFor="let rating of getRatingArray()" class="rating-option">
                  <input
                    type="radio"
                    [formControlName]="question.id"
                    [value]="rating"
                    [id]="'rating-' + question.id + '-' + rating"
                  />
                  <span class="rating-label">{{ rating }}</span>
                </label>
              </div>
              <div class="rating-scale-labels">
                <span i18n="@@evaluateForm.poorLabel">Poor</span>
                <span i18n="@@evaluateForm.excellentLabel">Excellent</span>
              </div>
            </fieldset>
          </div>

          <!-- Text Question -->
          <div *ngIf="question.type === 'TEXT'" class="text-container">
            <label class="question-label" [for]="'text-' + question.id">
              {{ i + 1 }}. {{ question.label }}
              <span class="required" *ngIf="question.required">*</span>
            </label>
            <textarea
              [formControlName]="question.id"
              [id]="'text-' + question.id"
              rows="4"
              i18n-placeholder="@@evaluateForm.responsePlaceholder"
              placeholder="Enter your response..."
              class="text-input"
            ></textarea>
          </div>

          <div class="error-message" *ngIf="isFieldInvalid(question.id)">
            <span i18n="@@evaluateForm.fieldRequired">This field is required</span>
          </div>
        </div>

        <div class="error-banner" *ngIf="validationError">
          {{ validationError }}
        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="router.navigate(['/'])" [disabled]="submitting">
            <span i18n="@@evaluateForm.cancel">Cancel</span>
          </button>
          <button type="submit" class="btn btn-primary" [disabled]="submitting">
            @if (submitting) {
              <span i18n="@@evaluateForm.submitting">Submitting...</span>
            } @else {
              <span i18n="@@evaluateForm.submit">Submit Evaluation</span>
            }
          </button>
        </div>
      </form>
    </div>

    <div class="loading-container" *ngIf="loading">
      <div class="spinner"></div>
      <p i18n="@@evaluateForm.loading">Loading form...</p>
    </div>

    <div class="error-container" *ngIf="error && !formData">
      <div class="error-icon">⚠️</div>
      <h2>{{ error }}</h2>
      <button class="btn btn-primary" (click)="router.navigate(['/'])"><span i18n="@@evaluateForm.backHome">Back to Home</span></button>
    </div>
  </div>
</app-background-div>

